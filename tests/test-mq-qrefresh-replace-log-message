#!/bin/sh

# Environement setup for MQ
export HGRCPATH=./hgrc
echo "[extensions]" >> ./hgrc
echo "mq=" >> ./hgrc

#Repo init
hg init
hg qinit

hg qnew -m "First commit message" first-patch
echo aaaa > file
hg add file
hg qrefresh
echo =======================
echo "Should display 'First commit message'"
hg log -l1 -v | sed -n '/description/,$p'
echo

# Testing changing message with -m
echo bbbb > file
hg qrefresh -m "Second commit message" 
echo =======================
echo "Should display 'Second commit message'"
hg log -l1 -v | sed -n '/description/,$p'
echo


# Testing changing message with -l
echo "Third commit message" > logfile
echo " This is the 3rd log message" >> logfile
echo bbbb > file
hg qrefresh -l logfile
echo =======================
echo "Should display 'Third commit message\n This is the 3rd log message'"
hg log -l1 -v | sed -n '/description/,$p'
echo

# Testing changing message with -l-
hg qnew -m "First commit message" second-patch
echo aaaa > file2
hg add file2
echo bbbb > file2
(echo "Fifth commit message" 
echo " This is the 5th log message" >> logfile) |\
hg qrefresh -l-
echo =======================
echo "Should display 'Fifth commit message\n This is the 5th log message'"
hg log -l1 -v | sed -n '/description/,$p'
echo
